var dY=dY||{};dY.Year=function(schema,ticks){this.schema=schema;this.ticks=ticks;}
dY.Year.prototype.metaOf=function(zonekey){if(zonekey.constructor===Array)return this.schema[zonekey[0]][zonekey[1]];return this.schema[Object.keys(this.schema)[0]][zonekey];};dY.Year.prototype.valuesOf=function(zonekey){return this.ticks.map(function(d){return d.valueOf(zonekey);});};dY.Year.prototype.dailySummary=function(dayCount=1){var slcs=[];var t=0;while(t<this.ticks.length){var timespan=dY.timeSpan.hoursOfYear(t,t+24*dayCount-1);var data=dY.util.summarizeTicks(this.schema,ticks.slice(t,t+24*dayCount));slcs.push(new dY.STick(timespan,data));t+=24*dayCount;}
return slcs;};dY.hourOfDaySummary=function(schema,ticks){var sortedTicks={};for(var t in ticks){var h=ticks[t].hourOfDay();if(!sortedTicks.hasOwnProperty(h))sortedTicks[h]=[];sortedTicks[h].push(ticks[t]);}
var ret=[];for(var h in sortedTicks){var timespan=dY.timeSpan.hourOfYear(parseInt(h));var data=dY.util.summarizeTicks(schema,sortedTicks[h]);var stick=new dY.STick(timespan,data);ret.push(stick);}
return ret;};var dY=dY||{};dY.dt={};dY.dt.year=1970;dY.dt.minsPerYr=525600;dY.dt.millsPerMin=60000;dY.dt.millsToMins=0.00001666666;dY.dt.dateStringToDate=function(str){splt=str.split("  ");date=splt[0].trim().split("/");month=parseInt(date[0])-1
day=parseInt(date[1])
hour=parseInt(splt[1].trim().split(":")[0])-1;dt=new Date(Date.UTC(dY.dt.year,month,day,hour,30));return dt;}
dY.dt.dateToHourOfYear=function(dt){start=new Date(Date.UTC(dY.dt.year,0,1,0,30));diff=dt-start;hour=Math.floor(diff/(1000*60*60));return hour;}
dY.dt.hourOfYearToDate=function(hr){return new Date((hr+0.5)*(1000*60*60));}
dY.dt.niceFormat=function(dt){var mth=dY.dt.monthTable[dt.getUTCMonth()].shortname;var dat=dt.getUTCDate();var hours=dt.getUTCHours();var mins=dt.getUTCMinutes();var pad=function(n){return(n<10)?("0"+n):n;}
return pad(dat)+" "+mth+" "+pad(hours)+":"+pad(mins)}
dY.dt.monthTable=[{idx:0,fullname:"January",shortname:"Jan",domain:[Date.UTC(dY.dt.year,0,1,0,0,0,0)*dY.dt.millsToMins,Date.UTC(dY.dt.year,1,1,0,0,0,0)*dY.dt.millsToMins]},{idx:1,fullname:"February",shortname:"Feb",domain:[Date.UTC(dY.dt.year,1,1,0,0,0,0)*dY.dt.millsToMins,Date.UTC(dY.dt.year,2,1,0,0,0,0)*dY.dt.millsToMins]},{idx:2,fullname:"March",shortname:"Mar",domain:[Date.UTC(dY.dt.year,2,1,0,0,0,0)*dY.dt.millsToMins,Date.UTC(dY.dt.year,3,1,0,0,0,0)*dY.dt.millsToMins]},{idx:3,fullname:"April",shortname:"Apr",domain:[Date.UTC(dY.dt.year,3,1,0,0,0,0)*dY.dt.millsToMins,Date.UTC(dY.dt.year,4,1,0,0,0,0)*dY.dt.millsToMins]},{idx:4,fullname:"May",shortname:"May",domain:[Date.UTC(dY.dt.year,4,1,0,0,0,0)*dY.dt.millsToMins,Date.UTC(dY.dt.year,5,1,0,0,0,0)*dY.dt.millsToMins]},{idx:5,fullname:"June",shortname:"Jun",domain:[Date.UTC(dY.dt.year,5,1,0,0,0,0)*dY.dt.millsToMins,Date.UTC(dY.dt.year,6,1,0,0,0,0)*dY.dt.millsToMins]},{idx:6,fullname:"July",shortname:"Jul",domain:[Date.UTC(dY.dt.year,6,1,0,0,0,0)*dY.dt.millsToMins,Date.UTC(dY.dt.year,7,1,0,0,0,0)*dY.dt.millsToMins]},{idx:7,fullname:"August",shortname:"Aug",domain:[Date.UTC(dY.dt.year,7,1,0,0,0,0)*dY.dt.millsToMins,Date.UTC(dY.dt.year,8,1,0,0,0,0)*dY.dt.millsToMins]},{idx:8,fullname:"September",shortname:"Sep",domain:[Date.UTC(dY.dt.year,8,1,0,0,0,0)*dY.dt.millsToMins,Date.UTC(dY.dt.year,9,1,0,0,0,0)*dY.dt.millsToMins]},{idx:9,fullname:"October",shortname:"Oct",domain:[Date.UTC(dY.dt.year,9,1,0,0,0,0)*dY.dt.millsToMins,Date.UTC(dY.dt.year,10,1,0,0,0,0)*dY.dt.millsToMins]},{idx:10,fullname:"November",shortname:"Nov",domain:[Date.UTC(dY.dt.year,10,1,0,0,0,0)*dY.dt.millsToMins,Date.UTC(dY.dt.year,11,1,0,0,0,0)*dY.dt.millsToMins]},{idx:11,fullname:"December",shortname:"Dec",domain:[Date.UTC(dY.dt.year,11,1,0,0,0,0)*dY.dt.millsToMins,Date.UTC(dY.dt.year+1,0,1,0,0,0,0)*dY.dt.millsToMins]}]
dY.dt.winterSolstice=Date.UTC(dY.dt.year,11,21,0,0,0,0)*dY.dt.millsToMins;dY.dt.springEquinox=Date.UTC(dY.dt.year,2,21,0,0,0,0)*dY.dt.millsToMins;dY.dt.summerSolstice=Date.UTC(dY.dt.year,5,21,0,0,0,0)*dY.dt.millsToMins;dY.dt.autumnalEquinox=Date.UTC(dY.dt.year,8,21,0,0,0,0)*dY.dt.millsToMins;dY.dt.seasonTable=[{idx:0,fullname:"Winter",domain:[dY.dt.winterSolstice,dY.dt.springEquinox+dY.dt.minsPerYr]},{idx:1,fullname:"Spring",domain:[dY.dt.springEquinox,dY.dt.summerSolstice]},{idx:2,fullname:"Summer",domain:[dY.dt.summerSolstice,dY.dt.autumnalEquinox]},{idx:3,fullname:"Autumn",domain:[dY.dt.autumnalEquinox,dY.dt.winterSolstice]},]
dY.timeSpan=function(start,end){if(Object.prototype.toString.call(start)=="[object Date]")start=+start
if(Object.prototype.toString.call(end)=="[object Date]")end=+end
if(end<=start)throw"timeSpans cannot be constructed backwards";if(start<0||end<0)throw"timeSpans cannot be negative";if((start>dY.dt.minsPerYr)&&(end>dY.dt.minsPerYr))throw"timeSpans should be constructed from a generic UTC year (1970)";this.spansYears=false;if(end>dY.dt.minsPerYr)this.spansYears=true;var a=Math.ceil(start);var b=Math.floor(end);this._=dY.dt.niceFormat(new Date(a*1000*60))+" -> "+dY.dt.niceFormat(new Date(b*1000*60))
this.min=a;this.max=b;this.mid=(b-a)*0.5+a;this.hourOfYearStart=function(){return Math.round(a/60);};this.hourOfYearMid=function(){return this.mid/60;};this.hourOfYearEnd=function(){return Math.round(b/60);};this.hourOfYear=function(){return Math.floor(this.hourOfYearMid())};this.hourOfYearDomain=function(){return[this.hourOfYearStart(),this.hourOfYearEnd()-1];};this.hoursOfYear=function(){return Array.from(new Array(this.durationHrs()),(x,i)=>i+this.hourOfYearStart());};this.dayOfYear=function(){return Math.floor(this.hourOfYear()/24);};this.hourOfDay=function(){return this.hourOfYear()%24;}
this.monthOfYear=function(){return new Date(this.mid*1000*60).getUTCMonth()}
this.season=function(){if(dY.timeSpan.season(0).contains(this))return 0;if(dY.timeSpan.season(1).contains(this))return 1;if(dY.timeSpan.season(2).contains(this))return 2;if(dY.timeSpan.season(3).contains(this))return 3;};this.duration=function(){return b-a;};this.durationHrs=function(){return Math.round((b-a)/60);};this.isHour=function(){return this.durationHrs()==1;};}
dY.timeSpan.prototype.contains=function(val){if((Object.prototype.toString.call(val)!=="[object Number]")&&(val.hasOwnProperty("mid")))val=val.mid;if((val<0)||(val>dY.dt.minsPerYr))console.warn("You asked timeSpan.contains("+val+"). timeSpans describe minutes of a generic UTC year (1970), so that  contained values must lie between 0 and "+dY.dt.minsPerYr);if(this.spansYears){if(val>=this.min)return true;if(val<this.max-dY.dt.minsPerYr)return true;return false;}else{return(val>=this.min&&val<this.max);}}
dY.timeSpan.prototype.report=function(){console.log(this._);console.log("\t hoy domain \t\t"+this.hourOfYearDomain());console.log("\t mid hr \t\t"+this.hourOfYearMid());console.log("\t dur\t\t"+this.duration());console.log("\t durHrs\t\t"+this.durationHrs());console.log("\t hour of year\t\t"+this.hourOfYear());console.log("\t day of year\t\t"+this.dayOfYear());console.log("\t hour of day\t\t"+this.hourOfDay());console.log("\t month of year\t\t"+this.monthOfYear());};dY.timeSpan.hourOfYear=function(hr){return new dY.timeSpan(hr*60,(hr+1)*60)}
dY.timeSpan.hoursOfYear=function(a,b){return new dY.timeSpan(a*60,b*60)}
dY.timeSpan.dayOfYear=function(day){return new dY.timeSpan((day*24)*60,((day+1)*24)*60)}
dY.timeSpan.daysOfYear=function(a,b){return new dY.timeSpan((a*24)*60,((b+1)*24)*60)}
dY.timeSpan.monthOfYear=function(mth){return new dY.timeSpan(dY.dt.monthTable[mth].domain[0],dY.dt.monthTable[mth].domain[1]);};dY.timeSpan.monthsOfYear=function(a,b){return new dY.timeSpan(dY.dt.monthTable[a].domain[0],dY.dt.monthTable[b].domain[1]);};dY.timeSpan.fullYear=new dY.timeSpan(0,525600);dY.timeSpan.janurary=dY.timeSpan.monthOfYear(0);dY.timeSpan.february=dY.timeSpan.monthOfYear(1);dY.timeSpan.march=dY.timeSpan.monthOfYear(2);dY.timeSpan.april=dY.timeSpan.monthOfYear(3);dY.timeSpan.may=dY.timeSpan.monthOfYear(4);dY.timeSpan.june=dY.timeSpan.monthOfYear(5);dY.timeSpan.july=dY.timeSpan.monthOfYear(6);dY.timeSpan.august=dY.timeSpan.monthOfYear(7);dY.timeSpan.september=dY.timeSpan.monthOfYear(8);dY.timeSpan.october=dY.timeSpan.monthOfYear(9);dY.timeSpan.november=dY.timeSpan.monthOfYear(10);dY.timeSpan.december=dY.timeSpan.monthOfYear(11);dY.timeSpan.season=function(s){return new dY.timeSpan(dY.dt.seasonTable[s].domain[0],dY.dt.seasonTable[s].domain[1]);};dY.timeSpan.winter=dY.timeSpan.season(0);dY.timeSpan.spring=dY.timeSpan.season(1);dY.timeSpan.summer=dY.timeSpan.season(2);dY.timeSpan.fall=dY.timeSpan.season(3);dY.timeSpan.autumn=dY.timeSpan.season(3);var dY=dY||{};dY.graph={};dY.graph.addBoard=function(selector,boardDims){dY.report("dy: adding an SVG to the document inside "+selector);if(!boardDims.hasOwnProperty("margin"))boardDims.margin=10;if(typeof(boardDims.margin)=="number")boardDims.margin={top:boardDims.margin,right:boardDims.margin,bottom:boardDims.margin,left:boardDims.margin};if(!boardDims.hasOwnProperty("width")||!boardDims.hasOwnProperty("height")){if(!boardDims.hasOwnProperty("inWidth")||!boardDims.hasOwnProperty("inHeight")){console.log("dY.graph.addBoard requires a defined width and height or a defined inWidth and inHeight");return false;}
boardDims.width=boardDims.inWidth+boardDims.margin.left+boardDims.margin.right
boardDims.height=boardDims.inHeight+boardDims.margin.top+boardDims.margin.bottom}else{boardDims.inWidth=boardDims.width-boardDims.margin.left-boardDims.margin.right
boardDims.inHeight=boardDims.height-boardDims.margin.top-boardDims.margin.bottom}
boardDims.range=[boardDims.width,boardDims.height]
drawDims={width:boardDims.inWidth,height:boardDims.inHeight,xRange:[0,boardDims.inWidth],yRange:[0,boardDims.inHeight],range:[boardDims.inWidth,boardDims.inHeight]}
svg=d3.select(selector).append("svg").attr("class","board").attr("width",boardDims.width).attr("height",boardDims.height).append("g").attr("transform","translate("+boardDims.margin.left+","+boardDims.margin.top+")");return{g:svg,bDims:boardDims,dDims:drawDims}}
var dY=dY||{};dY.parser={};function onDataLoaded(data,fields){dY.report("dhr: THIS IS A PLACEHOLDER FUNCTION - REPLACE WITH YOUR OWN");}
dY.report=function(msg){console.log(msg);}
dY.parser.EPWKeyDefs=[{key:"EtRadHorz",col:10},{key:"EtRadNorm",col:11},{key:"GblHorzIrad",col:13},{key:"DirNormIrad",col:14},{key:"DifHorzIrad",col:15},{key:"GblHorzIllum",col:16},{key:"DirNormIllum",col:17},{key:"DifHorzIllum",col:18},{key:"ZenLum",col:19},{key:"TotSkyCvr",col:22},{key:"OpqSkyCvr",col:23},{key:"DryBulbTemp",col:6},{key:"DewPtTemp",col:7},{key:"RelHumid",col:8},{key:"Pressure",col:9},{key:"WindDir",col:20},{key:"WindSpd",col:21},{key:"HorzVis",col:24},{key:"CeilHght",col:25},{key:"PreciptWater",col:28},{key:"AeroDepth",col:29},{key:"SnowDepth",col:30},{key:"DaysSinceSnow",col:31}];dY.parser.zoneKeyToString=function(zoneString,keyString){return zoneString.trim()+":"+keyString.trim()}
dY.parser.stringToZoneKey=function(str){str=str.trim();if(str.indexOf(":")==-1){if(str=="Date/Time")return false;dY.report("dy: Improperly formatted string for zoneKey. No separator found for '"+str+"'");return false;}
return[str.split(":")[0].trim(),str.substring(str.indexOf(":")+1)]}
dY.parser.handleParseErrors=function(results){if(results.errors.length>0){dY.report("dy: Parser encountered "+results.errors.length+" error(s).")
results.errors.forEach(function(error,n){if(error.code=="TooFewFields"&&error.row==results.data.length-1){dY.report("\tThe last row contained improperly formatted data. This happens all the time.");results.data.splice(results.data.length-1,1);}else{dY.report("\t"+n+"\t"+error.code+"; "+error.message+"; row: "+error.row);}});}
return true;}
dY.parser.handleParseEPlusResults=function(results,callback){dY.report("dy: Parsing EPlus Results File");if(!dY.parser.handleParseErrors(results)){dY.report("Parser failed. Quitting.");return false;}
schema={};if(results.meta.fields.length>0){dY.report("dy: Parser found "+results.meta.fields.length+" columns (not including Date/Time)")
zoneStrings=new Set();results.meta.fields.forEach(function(field,n){if(!dY.parser.stringToZoneKey(field))return;zoneStrings.add(dY.parser.stringToZoneKey(field)[0]);});zoneStrings=Array.from(zoneStrings);zoneStrings.forEach(function(zoneStr,n){schema[zoneStr]={};results.meta.fields.forEach(function(field,n){key=dY.parser.stringToZoneKey(field);if(key&&key[0]==zoneStr)schema[zoneStr][key[1]]={};});});}
dY.report("dy: Parser found "+results.data.length+" rows. Parser doesn't care about the number of rows nor their order.")
ticks=[];results.data.forEach(function(row,n){hourOfYear=dY.dt.dateToHourOfYear(dY.dt.dateStringToDate(row["Date/Time"]));timespan=dY.timeSpan.hourOfYear(hourOfYear);data={};for(var zon in schema){data[zon]={};for(var key in schema[zon]){value=row[dY.parser.zoneKeyToString(zon,key)];data[zon][key]=value;}}
ticks.push(new dY.Tick(timespan,data));});schema=dY.util.summarizeTicks(schema,ticks);yr=new dY.Year(schema,ticks)
if(typeof(callback)==='undefined'){return yr;}else{callback(yr);}}
dY.parser.handleParseEPWResults=function(head,results,callback){dY.report("dy: Parsing EPW Weather File");if(!dY.parser.handleParseErrors(results)){dY.report("Parser failed. Quitting.");return false;}
schema={EPW:{}};dY.parser.EPWKeyDefs.forEach(function(keyDef){schema["EPW"][keyDef.key]={};});dY.report("dy: Parser found "+results.data.length+" rows. We expect this to represent a full year of 8760 hours.")
ticks=[];results.data.forEach(function(row,n){datestring=dY.util.pad(row[1])+"/"+dY.util.pad(row[2])+"  "+dY.util.pad(row[3])+":00"
hourOfYear=dY.dt.dateToHourOfYear(dY.dt.dateStringToDate(datestring));timespan=dY.timeSpan.hourOfYear(hourOfYear);data={};data["EPW"]={};dY.parser.EPWKeyDefs.forEach(function(keyDef){value=row[keyDef.col];data["EPW"][keyDef.key]=value;});ticks.push(new dY.Tick(timespan,data));});schema=dY.util.summarizeTicks(schema,ticks);yr=new dY.Year(schema,ticks)
yr=dY.parser.handleEPWHeader(yr,head);if(typeof(callback)==='undefined'){return yr;}else{callback(yr);}}
dY.parser.handleEPWHeader=function(yr,headString){var head=headString.split("\n");var headLoc=head[0].split(",");var headDsgnCond=head[1].split(",");var headTypExtrmPeriods=head[2].split(",");var headGroundTemp=head[3].split(",");var headHolidayDaylightSvg=head[4].split(",");var headComments1=head[5].split(",");var headComments2=head[6].split(",");yr.epwhead={};yr.location={city:headLoc[1],state:headLoc[2],country:headLoc[3],source:headLoc[4],wmo:parseInt(headLoc[5]),latitude:parseFloat(headLoc[6]),longitude:parseFloat(headLoc[7]),timezone:parseFloat(headLoc[8]),elevation:parseFloat(headLoc[9])}
yr.epwhead.designConditions={source:headDsgnCond[2],note:"dY.parser doesn't currently handle most design condition data. Consider contributing to dY on GitHub!"}
yr.epwhead.holidaysDaylightSavings={leapYearObserved:headHolidayDaylightSvg[1]=="Yes",note:"dY.parser doesn't currently handle most Holiday/Daylight Savings data. Consider contributing to dY on GitHub!"}
yr.epwhead.comments={comments1:headComments1,comments2:headComments2,note:"dY.parser doesn't currently handle most comment data. Consider contributing to dY on GitHub!"}
yr.epwhead.periods={};var pcnt=parseInt(headTypExtrmPeriods[1]);for(var p=2;p<pcnt*4+2;p+=4){var type=headTypExtrmPeriods[p+1].toLowerCase();if(!yr.epwhead.periods.hasOwnProperty(type))yr.epwhead.periods[type]=[]
var hrDomain=[dY.dt.dateToHourOfYear(Date.parse(headTypExtrmPeriods[p+2]+"/"+dY.dt.year+" 00:30:00 UTC")),dY.dt.dateToHourOfYear(Date.parse(headTypExtrmPeriods[p+3]+"/"+dY.dt.year+" 23:30:00 UTC"))]
yr.epwhead.periods[type].push({name:headTypExtrmPeriods[p],domainStr:[headTypExtrmPeriods[p+2],headTypExtrmPeriods[p+3]],domain:hrDomain});}
yr.epwhead.ground=[];var gcnt=parseInt(headGroundTemp[1]);for(var g=2;g<gcnt*16+2;g+=16){var gobj={};gobj.depth=parseFloat(headGroundTemp[g]);gobj.conductivity=parseFloat(headGroundTemp[g+1]);gobj.density=parseFloat(headGroundTemp[g+2]);gobj.specificHeat=parseFloat(headGroundTemp[g+3]);gobj.monthlyTemperature=[];for(var m=0;m<12;m++){gobj.monthlyTemperature.push(parseFloat(headGroundTemp[g+m+4]));}
yr.epwhead.ground.push(gobj);}
return yr;}
dY.parser.handleSingleEPlusFileUpload=function(evt){var file=evt.target.files[0];Papa.parse(file,{header:true,dynamicTyping:true,complete:function(results){dY.parser.handleParseEPlusResults(results,onDataLoaded);}});}
dY.parser.handleSingleEPWFileUpload=function(evt){var file=evt.target.files[0];var reader=new FileReader();reader.onload=function(){splt=this.result.split("\n");head=splt.slice(0,8).join("\n");body=splt.slice(8,splt.length).join("\n");console.log("done reading");Papa.parse(body,{delimiter:",",skipEmptyLines:true,header:false,dynamicTyping:true,complete:function(results){dY.parser.handleParseEPWResults(head,results,onDataLoaded);}});}
reader.readAsText(file);}
var readFileData=new Object;dY.parser.handleMultDBuilderFileUpload=function(evt){doubleDigit=function(numstring){simplestring=numstring.replace(/"/g,'').trim()
if(simplestring.length>=2){return simplestring;}else{return"0"+simplestring;}}
multiRead=function(files){var j=0,k=files.length;for(var i=0;i<k;i++){var reader=new FileReader();reader.name=files[i].name;reader.onloadend=function(evt){if(evt.target.readyState==FileReader.DONE){readFileData[this.name]=evt.target.result;j++;if(j==k){doIt(readFileData);}}};reader.readAsText(files[i]);}}
var doIt=function(filedata){var headCount=2;var combinedContentRows=new Array(8760);var combinedHeaderRows="Date/Time";var init=true;for(var filename in filedata){var fileContent=filedata[filename];var splitContent=fileContent.split("\n");headRows=splitContent.slice(0,2);contentRows=splitContent.slice(2);var firstSplitHeadRow=headRows[0].split(",");var secondSplitHeadRow=headRows[1].split(",");if(firstSplitHeadRow[firstSplitHeadRow.length-1].trim()=="")firstSplitHeadRow.pop();if(secondSplitHeadRow[secondSplitHeadRow.length-1].trim()=="")secondSplitHeadRow.pop();var fname=filename.slice(0,-4);for(var col=1;col<firstSplitHeadRow.length;col++){var str=fname+":"+firstSplitHeadRow[col]+"["+secondSplitHeadRow[col].replace(/[^\w\s]/gi,'')+"]";var res=str.replace(/"/g,'')
combinedHeaderRows=combinedHeaderRows+","+res;}
if(init){var prevDay=-1;var prevMth=-1;for(var row=0;row<(contentRows.length-1);row++){var firstSpace=contentRows[row].indexOf(" ");var lastSpace=contentRows[row].lastIndexOf(" ");var month=doubleDigit(contentRows[row].slice(0,contentRows[row].indexOf("/")));var day=doubleDigit(contentRows[row].slice(contentRows[row].indexOf("/")+1,contentRows[row].lastIndexOf("/")));if(contentRows[row].indexOf(" ")==-1){var loc=contentRows[row].length;}else{var loc=firstSpace;}
if(firstSpace==-1){var hour=24;if(month!=prevMth)month=prevMth;day=prevDay;}else{var hour=parseInt(contentRows[row].slice(firstSpace,contentRows[row].indexOf(":")).trim());if((contentRows[row].slice(lastSpace+1,lastSpace+3)=="PM")&&(hour!=12)){hour=hour+12;}}
hour=doubleDigit(hour.toString());combinedContentRows[row]=month+'/'+day+'  '+hour+":00:00"
prevDay=day;prevMth=month;}
init=false;}
for(var row=0;row<(contentRows.length-1);row++){var str=contentRows[row].slice(contentRows[row].indexOf(",")+1).trim()
var res=str.replace(/"/g,'')
combinedContentRows[row]=combinedContentRows[row]+","+res;}
for(var row=0;row<combinedContentRows.length-1;row++){if(combinedContentRows[row][combinedContentRows[row].length-1]==",")combinedContentRows[row]=combinedContentRows[row].slice(0,-1);}}
combinedContentRows.unshift(combinedHeaderRows);var fakeEPString=combinedContentRows.join("\n");var data=Papa.parse(fakeEPString,{header:true,delimiter:",",newline:"\n",dynamicTyping:true,complete:function(results){dY.parser.handleParseEPlusResults(results,onDataLoaded);}});}
multiRead(evt.target.files);}
var dY=dY||{};dY.solarGeom={};dY.solarGeom.dailyAtGivenHour=function(loc,hourOfDay){var days=[...Array(365).keys()];var data=days.map(function(d){result=dY.solarGeom.solarGeomAtHour(loc,d,hourOfDay);result.dayOfYear=d;return result;});return{location:loc,hourOfDay:hourOfDay,data:data}}
dY.solarGeom.hourlyAtGivenDay=function(loc,dayOfYear){var hrs=[...Array(24).keys()];var data=hrs.map(function(h){return dY.solarGeom.solarGeomAtHour(loc,dayOfYear,h);});var swtch=false;var sunrise,sunset;for(var d in data){var sunIsUp=data[d].altitudeDeg>0.0;if(sunIsUp!=swtch){if(sunIsUp)sunrise=dY.util.remap([data[d-1].altitudeDeg,data[d].altitudeDeg],[d-1,d],0.0);else sunset=dY.util.remap([data[d-1].altitudeDeg,data[d].altitudeDeg],[d-1,d],0.0);swtch=sunIsUp;}}
return{location:loc,dayOfYear:dayOfYear,data:data,sunrise:sunrise,sunset:sunset}}
dY.solarGeom.geomNearHourOfYear=function(loc,hourOfYear,resolution){if(typeof resolution==="undefined")resolution=5;if(resolution%2==1)resolution+=1;var hrs=[];for(var t=0;t<=1.0;t+=1.0/resolution)hrs.push(hourOfYear-0.5+t);var data=hrs.map(function(d){var result=dY.solarGeom.solarGeomAtHour(loc,d);result.hourOfYear=d;return result;});var func=function(a,b){if(b.altitudeDeg>=0.0){return a+1}else{return a}}
var sunUpPercent=data.reduce(func,0)/data.length;return{location:loc,hourOfYear:hourOfYear,data:data,sunUpPercent:sunUpPercent}}
dY.solarGeom.vecAtHour=function(loc,argA,argB){var sGeom=dY.solarGeom.solarGeomAtHour(loc,argA,argB)
var x=Math.cos(sGeom.altitudeRad)*Math.sin(sGeom.azimuthRad)
var y=Math.cos(sGeom.altitudeRad)*Math.cos(sGeom.azimuthRad)
var z=Math.sin(sGeom.altitudeRad)
return[x,y,z]}
dY.solarGeom.degAnglesAtHour=function(loc,argA,argB){var sGeom=dY.solarGeom.solarGeomAtHour(loc,argA,argB)
return{altitude:sGeom.altitudeDeg,azimuth:sGeom.azimuthDeg}}
dY.solarGeom.radAnglesAtHour=function(loc,argA,argB){var sGeom=dY.solarGeom.solarGeomAtHour(loc,argA,argB)
return{altitude:sGeom.altitudeRad,azimuth:sGeom.azimuthRad}}
dY.solarGeom.solarGeomAtHour=function(loc,argA,argB){var dayOfYear=argA;var hourOfDay=argB;if(typeof argB==="undefined"){if(typeof argA==="number"){var dayOfYear=Math.floor(argA/24);var hourOfDay=argA%24;}
if(typeof argA==="object"){var dayOfYear=argA.dayOfYear();var hourOfDay=argA.hourOfDay()+0.5;}}
var lat=loc.latitude;var lng=loc.longitude;var tmz=loc.timezone;var alpha=dY.solarGeom.calcAlpha(dayOfYear,hourOfDay);var decDeg=0.396372-22.91327*Math.cos(alpha)+4.02543*Math.sin(alpha)-0.387205*Math.cos(2*alpha)+0.051967*Math.sin(2*alpha)-0.154527*Math.cos(3*alpha)+0.084798*Math.sin(3*alpha);var decRad=dY.solarGeom.degToRad(decDeg);var tc=0.004297+0.107029*Math.cos(alpha)-1.837877*Math.sin(alpha)-0.837378*Math.cos(2*alpha)-2.340475*Math.sin(2*alpha);var hAngDeg=(hourOfDay-12-tmz)*(360/24)+lng+tc;if(hAngDeg>=180)hAngDeg=hAngDeg-360;if(hAngDeg<=-180)hAngDeg=hAngDeg+360;var hAngRad=dY.solarGeom.degToRad(hAngDeg);var latRad=dY.solarGeom.degToRad(lat);var cosZenith=Math.sin(latRad)*Math.sin(decRad)+Math.cos(latRad)*Math.cos(decRad)*Math.cos(hAngRad);if(cosZenith>1)cosZenith=1;if(cosZenith<-1)cosZenith=-1;var zenRad=Math.acos(cosZenith)
var altRad=Math.asin(cosZenith)
var cosAzi=(Math.sin(decRad)-Math.sin(latRad)*Math.cos(zenRad))/(Math.cos(latRad)*Math.sin(zenRad));var aziDeg=dY.solarGeom.radToDeg(Math.acos(cosAzi));if(hAngRad>0)aziDeg=360-aziDeg;var aziRad=dY.solarGeom.degToRad(aziDeg);return{altitudeRad:altRad,altitudeDeg:dY.solarGeom.radToDeg(altRad),azimuthRad:aziRad,azimuthDeg:aziDeg,declinationRad:decRad,declinationDeg:decDeg,hourAngleRad:hAngRad,hourAngleDeg:hAngDeg}}
dY.solarGeom.calcAlpha=function(dayOfYear,hourOfDay){return dY.solarGeom.degToRad((360/365.25)*(dayOfYear+hourOfDay/24));}
dY.solarGeom.degToRad=function(degrees){return degrees*(Math.PI/180);}
dY.solarGeom.radToDeg=function(radians){return radians*(180/Math.PI);}
dY.lunarGeom={};dY.lunarGeom.hourlyAtGivenDay=function(loc,dayOfYear){var hrs=[...Array(24).keys()];var data=hrs.map(function(h){return dY.lunarGeom.lunarGeomAtHour(loc,dayOfYear,h);});return{location:loc,dayOfYear:dayOfYear,data:data}}
dY.lunarGeom.e=dY.solarGeom.degToRad(23.4397);dY.lunarGeom.rightAscension=function(l,b){return Math.atan2(Math.sin(l)*Math.cos(dY.lunarGeom.e)-Math.tan(b)*Math.sin(dY.lunarGeom.e),Math.cos(l));}
dY.lunarGeom.declination=function(l,b){return Math.asin(Math.sin(b)*Math.cos(dY.lunarGeom.e)+Math.cos(b)*Math.sin(dY.lunarGeom.e)*Math.sin(l));}
dY.lunarGeom.azimuth=function(H,phi,dec){return Math.atan2(Math.sin(H),Math.cos(H)*Math.sin(phi)-Math.tan(dec)*Math.cos(phi));}
dY.lunarGeom.altitude=function(H,phi,dec){return Math.asin(Math.sin(phi)*Math.sin(dec)+Math.cos(phi)*Math.cos(dec)*Math.cos(H));}
dY.lunarGeom.siderealTime=function(d,lw){return dY.solarGeom.degToRad((280.16+360.9856235*d))-lw;}
dY.lunarGeom.astroRefraction=function(h){if(h<0)
h=0;return 0.0002967/Math.tan(h+0.00312536/(h+0.08901179));}
dY.lunarGeom.moonCoords=function(d){var L=dY.solarGeom.degToRad((218.316+13.176396*d)),M=dY.solarGeom.degToRad((134.963+13.064993*d)),F=dY.solarGeom.degToRad((93.272+13.229350*d)),l=L+dY.solarGeom.degToRad(6.289*Math.sin(M)),b=dY.solarGeom.degToRad(5.128*Math.sin(F)),dt=385001-20905*Math.cos(M);return{ra:dY.lunarGeom.rightAscension(l,b),dec:dY.lunarGeom.declination(l,b),dist:dt};}
dY.lunarGeom.lunarGeomAtHour=function(loc,argA,argB){var dayOfYear=argA;var hourOfDay=argB;if(typeof argB==="undefined"){if(typeof argA==="number"){var dayOfYear=Math.floor(argA/24);var hourOfDay=argA%24;}
if(typeof argA==="object"){var dayOfYear=argA.dayOfYear();var hourOfDay=argA.hourOfDay()+0.5;}}
var date=dY.dt.hourOfYearToDate(dayOfYear*24+hourOfDay);var lat=loc.latitude;var lng=loc.longitude;var dayMs=1000*60*60*24,J1970=2440588,J2000=2451545;function toJulian(date){return date.valueOf()/dayMs-0.5+J1970;}
function fromJulian(j){return new Date((j+0.5-J1970)*dayMs);}
function toDays(date){return toJulian(date)-J2000;}
var lw=dY.solarGeom.degToRad(-lng),phi=dY.solarGeom.degToRad(lat),d=toDays(date),c=dY.lunarGeom.moonCoords(d),H=dY.lunarGeom.siderealTime(d,lw)-c.ra,h=dY.lunarGeom.altitude(H,phi,c.dec),pa=Math.atan2(Math.sin(H),Math.tan(phi)*Math.cos(c.dec)-Math.sin(c.dec)*Math.cos(H));var h=h+dY.lunarGeom.astroRefraction(h);var aziRad=dY.lunarGeom.azimuth(H,phi,c.dec);var altRad=h;return{azimuthRad:aziRad,altitudeRad:altRad,azimuthDeg:dY.solarGeom.radToDeg(aziRad),altitudeDeg:dY.solarGeom.radToDeg(altRad),distance:c.dist,parallacticAngleRad:pa};};var dY=dY||{};dY.Tick=function(timespan,data){this.ts=timespan;this.hourOfYear=timespan.hourOfYear();this.data=data;}
dY.Tick.prototype.valueOf=function(zonekey){if(zonekey.constructor===Array)return this.data[zonekey[0]][zonekey[1]];return this.data[Object.keys(this.data)[0]][zonekey];};dY.Tick.prototype.hourOfYear=function(){return this.ts.hourOfYear();};dY.Tick.prototype.dayOfYear=function(){return this.ts.dayOfYear();};dY.Tick.prototype.hourOfDay=function(){return this.ts.hourOfDay();};dY.Tick.prototype.monthOfYear=function(){return this.ts.monthOfYear();};dY.Tick.prototype.season=function(){return this.ts.season();};dY.Tick.prototype.isIn=function(ts){return ts.contains(this.ts.mid);};dY.STick=function(timespan,data){this.ts=timespan;this.data=data;}
dY.STick.prototype.metaOf=function(zonekey){if(zonekey.constructor===Array)return this.data[zonekey[0]][zonekey[1]];return this.data[Object.keys(this.data)[0]][zonekey];};dY.STick.prototype.averageOf=function(zonekey){return this.metaOf(zonekey).average};dY.STick.prototype.domainOf=function(zonekey){return this.metaOf(zonekey).domain};dY.STick.prototype.maxOf=function(zonekey){return this.metaOf(zonekey).max};dY.STick.prototype.medianOf=function(zonekey){return this.metaOf(zonekey).median};dY.STick.prototype.minOf=function(zonekey){return this.metaOf(zonekey).min};dY.STick.prototype.q1Of=function(zonekey){return this.metaOf(zonekey).q1};dY.STick.prototype.q2Of=function(zonekey){return this.metaOf(zonekey).q2};dY.STick.prototype.q3Of=function(zonekey){return this.metaOf(zonekey).q3};dY.STick.prototype.hourOfYear=function(){return this.ts.hourOfYear();};dY.STick.prototype.dayOfYear=function(){return this.ts.dayOfYear();};dY.STick.prototype.hourOfDay=function(){return this.ts.hourOfDay();};dY.STick.prototype.monthOfYear=function(){return this.ts.monthOfYear();};dY.STick.prototype.isIn=function(ts){return ts.contains(this.ts.mid);};var dY=dY||{};dY.util={};dY.util.loadCSS=function(path){dY.report("dy: attempting to load CSS file "+path);var file=location.pathname.split("/").pop();var link=document.createElement("link");link.href=path;link.type="text/css";link.rel="stylesheet";link.media="screen,print";document.getElementsByTagName("head")[0].appendChild(link);}
dY.util.pad=function(n){return(n<10)?("0"+n):n;}
dY.util.remap=function(src,tar,srcVal){var t=(srcVal-src[0])/(src[1]-src[0]);return(tar[1]-tar[0])*t+tar[0];}
dY.util.splitAtDiscontinuousHours=function(arr,key){var bins=[];var bin=[arr[0]];var idx=arr[0][key];for(var n=1;n<arr.length;n++){if(arr[n][key]!=idx+1){bin.domain=[bin[0][key],bin[bin.length-1][key]];bins.push(bin);bin=[arr[n]];}else{bin.push(arr[n]);}
idx=arr[n][key];}
bin.domain=[bin[0][key],bin[bin.length-1][key]];bins.push(bin);return bins;}
dY.util.summarizeTicks=function(schema,ticks){var summarySchema={}
var alls=[];for(var zon in schema){summarySchema[zon]={}
for(var key in schema[zon]){summarySchema[zon][key]={}
alls[[zon,key]]=[];}}
for(var t in ticks){for(var zon in schema){for(var key in schema[zon]){alls[[zon,key]].push(ticks[t].data[zon][key]);}}};for(var zon in schema){for(var key in schema[zon]){var allsorted=alls[[zon,key]].sort(function(a,b){return a-b});var len=allsorted.length;summarySchema[zon][key].min=allsorted[0];summarySchema[zon][key].q1=allsorted[Math.floor(len*.25)-1];summarySchema[zon][key].q2=allsorted[Math.floor(len*.50)-1];summarySchema[zon][key].q3=allsorted[Math.floor(len*.75)-1];summarySchema[zon][key].max=allsorted[len-1];summarySchema[zon][key].domain=[summarySchema[zon][key].min,summarySchema[zon][key].max];summarySchema[zon][key].median=summarySchema[zon][key].q2;var sum=0;for(var i=0;i<allsorted.length;i++){sum+=allsorted[i];}
summarySchema[zon][key].average=sum/len;}}
return summarySchema;}/*!
	Papa Parse
	v4.1.2
	https://github.com/mholt/PapaParse
*/

!function(e){"use strict";function t(t,r){if(r=r||{},r.worker&&S.WORKERS_SUPPORTED){var n=f();return n.userStep=r.step,n.userChunk=r.chunk,n.userComplete=r.complete,n.userError=r.error,r.step=m(r.step),r.chunk=m(r.chunk),r.complete=m(r.complete),r.error=m(r.error),delete r.worker,void n.postMessage({input:t,config:r,workerId:n.id})}var o=null;return"string"==typeof t?o=r.download?new i(r):new a(r):(e.File&&t instanceof File||t instanceof Object)&&(o=new s(r)),o.stream(t)}function r(e,t){function r(){"object"==typeof t&&("string"==typeof t.delimiter&&1==t.delimiter.length&&-1==S.BAD_DELIMITERS.indexOf(t.delimiter)&&(u=t.delimiter),("boolean"==typeof t.quotes||t.quotes instanceof Array)&&(o=t.quotes),"string"==typeof t.newline&&(h=t.newline))}function n(e){if("object"!=typeof e)return[];var t=[];for(var r in e)t.push(r);return t}function i(e,t){var r="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var n=e instanceof Array&&e.length>0,i=!(t[0]instanceof Array);if(n){for(var a=0;a<e.length;a++)a>0&&(r+=u),r+=s(e[a],a);t.length>0&&(r+=h)}for(var o=0;o<t.length;o++){for(var f=n?e.length:t[o].length,c=0;f>c;c++){c>0&&(r+=u);var d=n&&i?e[c]:c;r+=s(t[o][d],c)}o<t.length-1&&(r+=h)}return r}function s(e,t){if("undefined"==typeof e||null===e)return"";e=e.toString().replace(/"/g,'""');var r="boolean"==typeof o&&o||o instanceof Array&&o[t]||a(e,S.BAD_DELIMITERS)||e.indexOf(u)>-1||" "==e.charAt(0)||" "==e.charAt(e.length-1);return r?'"'+e+'"':e}function a(e,t){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>-1)return!0;return!1}var o=!1,u=",",h="\r\n";if(r(),"string"==typeof e&&(e=JSON.parse(e)),e instanceof Array){if(!e.length||e[0]instanceof Array)return i(null,e);if("object"==typeof e[0])return i(n(e[0]),e)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),e.data instanceof Array&&(e.fields||(e.fields=e.data[0]instanceof Array?e.fields:n(e.data[0])),e.data[0]instanceof Array||"object"==typeof e.data[0]||(e.data=[e.data])),i(e.fields||[],e.data||[]);throw"exception: Unable to serialize unrecognized input"}function n(t){function r(e){var t=_(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new o(t),this._handle.streamer=this,this._config=t}this._handle=null,this._paused=!1,this._finished=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},r.call(this,t),this.parseChunk=function(t){if(this.isFirstChunk&&m(this._config.beforeFirstChunk)){var r=this._config.beforeFirstChunk(t);void 0!==r&&(t=r)}this.isFirstChunk=!1;var n=this._partialLine+t;this._partialLine="";var i=this._handle.parse(n,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var s=i.meta.cursor;this._finished||(this._partialLine=n.substring(s-this._baseIndex),this._baseIndex=s),i&&i.data&&(this._rowCount+=i.data.length);var a=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(y)e.postMessage({results:i,workerId:S.WORKER_ID,finished:a});else if(m(this._config.chunk)){if(this._config.chunk(i,this._handle),this._paused)return;i=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(i.data),this._completeResults.errors=this._completeResults.errors.concat(i.errors),this._completeResults.meta=i.meta),!a||!m(this._config.complete)||i&&i.meta.aborted||this._config.complete(this._completeResults),a||i&&i.meta.paused||this._nextChunk(),i}},this._sendError=function(t){m(this._config.error)?this._config.error(t):y&&this._config.error&&e.postMessage({workerId:S.WORKER_ID,error:t,finished:!1})}}function i(e){function t(e){var t=e.getResponseHeader("Content-Range");return parseInt(t.substr(t.lastIndexOf("/")+1))}e=e||{},e.chunkSize||(e.chunkSize=S.RemoteChunkSize),n.call(this,e);var r;this._nextChunk=k?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)return void this._chunkLoaded();if(r=new XMLHttpRequest,k||(r.onload=g(this._chunkLoaded,this),r.onerror=g(this._chunkError,this)),r.open("GET",this._input,!k),this._config.chunkSize){var e=this._start+this._config.chunkSize-1;r.setRequestHeader("Range","bytes="+this._start+"-"+e),r.setRequestHeader("If-None-Match","webkit-no-cache")}try{r.send()}catch(t){this._chunkError(t.message)}k&&0==r.status?this._chunkError():this._start+=this._config.chunkSize},this._chunkLoaded=function(){if(4==r.readyState){if(r.status<200||r.status>=400)return void this._chunkError();this._finished=!this._config.chunkSize||this._start>t(r),this.parseChunk(r.responseText)}},this._chunkError=function(e){var t=r.statusText||e;this._sendError(t)}}function s(e){e=e||{},e.chunkSize||(e.chunkSize=S.LocalChunkSize),n.call(this,e);var t,r,i="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,r=e.slice||e.webkitSlice||e.mozSlice,i?(t=new FileReader,t.onload=g(this._chunkLoaded,this),t.onerror=g(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var n=Math.min(this._start+this._config.chunkSize,this._input.size);e=r.call(e,this._start,n)}var s=t.readAsText(e,this._config.encoding);i||this._chunkLoaded({target:{result:s}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function a(e){e=e||{},n.call(this,e);var t,r;this.stream=function(e){return t=e,r=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e=this._config.chunkSize,t=e?r.substr(0,e):r;return r=e?r.substr(e):"",this._finished=!r,this.parseChunk(t)}}}function o(e){function t(){if(b&&d&&(h("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+S.DefaultDelimiter+"'"),d=!1),e.skipEmptyLines)for(var t=0;t<b.data.length;t++)1==b.data[t].length&&""==b.data[t][0]&&b.data.splice(t--,1);return r()&&n(),i()}function r(){return e.header&&0==y.length}function n(){if(b){for(var e=0;r()&&e<b.data.length;e++)for(var t=0;t<b.data[e].length;t++)y.push(b.data[e][t]);b.data.splice(0,1)}}function i(){if(!b||!e.header&&!e.dynamicTyping)return b;for(var t=0;t<b.data.length;t++){for(var r={},n=0;n<b.data[t].length;n++){if(e.dynamicTyping){var i=b.data[t][n];b.data[t][n]="true"==i||"TRUE"==i?!0:"false"==i||"FALSE"==i?!1:o(i)}e.header&&(n>=y.length?(r.__parsed_extra||(r.__parsed_extra=[]),r.__parsed_extra.push(b.data[t][n])):r[y[n]]=b.data[t][n])}e.header&&(b.data[t]=r,n>y.length?h("FieldMismatch","TooManyFields","Too many fields: expected "+y.length+" fields but parsed "+n,t):n<y.length&&h("FieldMismatch","TooFewFields","Too few fields: expected "+y.length+" fields but parsed "+n,t))}return e.header&&b.meta&&(b.meta.fields=y),b}function s(t){for(var r,n,i,s=[",","	","|",";",S.RECORD_SEP,S.UNIT_SEP],a=0;a<s.length;a++){var o=s[a],h=0,f=0;i=void 0;for(var c=new u({delimiter:o,preview:10}).parse(t),d=0;d<c.data.length;d++){var l=c.data[d].length;f+=l,"undefined"!=typeof i?l>1&&(h+=Math.abs(l-i),i=l):i=l}c.data.length>0&&(f/=c.data.length),("undefined"==typeof n||n>h)&&f>1.99&&(n=h,r=o)}return e.delimiter=r,{successful:!!r,bestDelimiter:r}}function a(e){e=e.substr(0,1048576);var t=e.split("\r");if(1==t.length)return"\n";for(var r=0,n=0;n<t.length;n++)"\n"==t[n][0]&&r++;return r>=t.length/2?"\r\n":"\r"}function o(e){var t=l.test(e);return t?parseFloat(e):e}function h(e,t,r,n){b.errors.push({type:e,code:t,message:r,row:n})}var f,c,d,l=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,p=this,g=0,v=!1,k=!1,y=[],b={data:[],errors:[],meta:{}};if(m(e.step)){var R=e.step;e.step=function(n){if(b=n,r())t();else{if(t(),0==b.data.length)return;g+=n.data.length,e.preview&&g>e.preview?c.abort():R(b,p)}}}this.parse=function(r,n,i){if(e.newline||(e.newline=a(r)),d=!1,!e.delimiter){var o=s(r);o.successful?e.delimiter=o.bestDelimiter:(d=!0,e.delimiter=S.DefaultDelimiter),b.meta.delimiter=e.delimiter}var h=_(e);return e.preview&&e.header&&h.preview++,f=r,c=new u(h),b=c.parse(f,n,i),t(),v?{meta:{paused:!0}}:b||{meta:{paused:!1}}},this.paused=function(){return v},this.pause=function(){v=!0,c.abort(),f=f.substr(c.getCharIndex())},this.resume=function(){v=!1,p.streamer.parseChunk(f)},this.aborted=function(){return k},this.abort=function(){k=!0,c.abort(),b.meta.aborted=!0,m(e.complete)&&e.complete(b),f=""}}function u(e){e=e||{};var t=e.delimiter,r=e.newline,n=e.comments,i=e.step,s=e.preview,a=e.fastMode;if(("string"!=typeof t||S.BAD_DELIMITERS.indexOf(t)>-1)&&(t=","),n===t)throw"Comment character same as delimiter";n===!0?n="#":("string"!=typeof n||S.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),"\n"!=r&&"\r"!=r&&"\r\n"!=r&&(r="\n");var o=0,u=!1;this.parse=function(e,h,f){function c(e){b.push(e),S=o}function d(t){return f?p():("undefined"==typeof t&&(t=e.substr(o)),w.push(t),o=g,c(w),y&&_(),p())}function l(t){o=t,c(w),w=[],O=e.indexOf(r,o)}function p(e){return{data:b,errors:R,meta:{delimiter:t,linebreak:r,aborted:u,truncated:!!e,cursor:S+(h||0)}}}function _(){i(p()),b=[],R=[]}if("string"!=typeof e)throw"Input must be a string";var g=e.length,m=t.length,v=r.length,k=n.length,y="function"==typeof i;o=0;var b=[],R=[],w=[],S=0;if(!e)return p();if(a||a!==!1&&-1===e.indexOf('"')){for(var C=e.split(r),E=0;E<C.length;E++){var w=C[E];if(o+=w.length,E!==C.length-1)o+=r.length;else if(f)return p();if(!n||w.substr(0,k)!=n){if(y){if(b=[],c(w.split(t)),_(),u)return p()}else c(w.split(t));if(s&&E>=s)return b=b.slice(0,s),p(!0)}}return p()}for(var x=e.indexOf(t,o),O=e.indexOf(r,o);;)if('"'!=e[o])if(n&&0===w.length&&e.substr(o,k)===n){if(-1==O)return p();o=O+v,O=e.indexOf(r,o),x=e.indexOf(t,o)}else if(-1!==x&&(O>x||-1===O))w.push(e.substring(o,x)),o=x+m,x=e.indexOf(t,o);else{if(-1===O)break;if(w.push(e.substring(o,O)),l(O+v),y&&(_(),u))return p();if(s&&b.length>=s)return p(!0)}else{var I=o;for(o++;;){var I=e.indexOf('"',I+1);if(-1===I)return f||R.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:b.length,index:o}),d();if(I===g-1){var D=e.substring(o,I).replace(/""/g,'"');return d(D)}if('"'!=e[I+1]){if(e[I+1]==t){w.push(e.substring(o,I).replace(/""/g,'"')),o=I+1+m,x=e.indexOf(t,o),O=e.indexOf(r,o);break}if(e.substr(I+1,v)===r){if(w.push(e.substring(o,I).replace(/""/g,'"')),l(I+1+v),x=e.indexOf(t,o),y&&(_(),u))return p();if(s&&b.length>=s)return p(!0);break}}else I++}}return d()},this.abort=function(){u=!0},this.getCharIndex=function(){return o}}function h(){var e=document.getElementsByTagName("script");return e.length?e[e.length-1].src:""}function f(){if(!S.WORKERS_SUPPORTED)return!1;if(!b&&null===S.SCRIPT_PATH)throw new Error("Script path cannot be determined automatically when Papa Parse is loaded asynchronously. You need to set Papa.SCRIPT_PATH manually.");var t=S.SCRIPT_PATH||v;t+=(-1!==t.indexOf("?")?"&":"?")+"papaworker";var r=new e.Worker(t);return r.onmessage=c,r.id=w++,R[r.id]=r,r}function c(e){var t=e.data,r=R[t.workerId],n=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var i=function(){n=!0,d(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},s={abort:i,pause:l,resume:l};if(m(r.userStep)){for(var a=0;a<t.results.data.length&&(r.userStep({data:[t.results.data[a]],errors:t.results.errors,meta:t.results.meta},s),!n);a++);delete t.results}else m(r.userChunk)&&(r.userChunk(t.results,s,t.file),delete t.results)}t.finished&&!n&&d(t.workerId,t.results)}function d(e,t){var r=R[e];m(r.userComplete)&&r.userComplete(t),r.terminate(),delete R[e]}function l(){throw"Not implemented."}function p(t){var r=t.data;if("undefined"==typeof S.WORKER_ID&&r&&(S.WORKER_ID=r.workerId),"string"==typeof r.input)e.postMessage({workerId:S.WORKER_ID,results:S.parse(r.input,r.config),finished:!0});else if(e.File&&r.input instanceof File||r.input instanceof Object){var n=S.parse(r.input,r.config);n&&e.postMessage({workerId:S.WORKER_ID,results:n,finished:!0})}}function _(e){if("object"!=typeof e)return e;var t=e instanceof Array?[]:{};for(var r in e)t[r]=_(e[r]);return t}function g(e,t){return function(){e.apply(t,arguments)}}function m(e){return"function"==typeof e}var v,k=!e.document&&!!e.postMessage,y=k&&/(\?|&)papaworker(=|&|$)/.test(e.location.search),b=!1,R={},w=0,S={};if(S.parse=t,S.unparse=r,S.RECORD_SEP=String.fromCharCode(30),S.UNIT_SEP=String.fromCharCode(31),S.BYTE_ORDER_MARK="ï»¿",S.BAD_DELIMITERS=["\r","\n",'"',S.BYTE_ORDER_MARK],S.WORKERS_SUPPORTED=!k&&!!e.Worker,S.SCRIPT_PATH=null,S.LocalChunkSize=10485760,S.RemoteChunkSize=5242880,S.DefaultDelimiter=",",S.Parser=u,S.ParserHandle=o,S.NetworkStreamer=i,S.FileStreamer=s,S.StringStreamer=a,"undefined"!=typeof module&&module.exports?module.exports=S:m(e.define)&&e.define.amd?define(function(){return S}):e.Papa=S,e.jQuery){var C=e.jQuery;C.fn.parse=function(t){function r(){if(0==a.length)return void(m(t.complete)&&t.complete());var e=a[0];if(m(t.before)){var r=t.before(e.file,e.inputElem);if("object"==typeof r){if("abort"==r.action)return void n("AbortError",e.file,e.inputElem,r.reason);if("skip"==r.action)return void i();"object"==typeof r.config&&(e.instanceConfig=C.extend(e.instanceConfig,r.config))}else if("skip"==r)return void i()}var s=e.instanceConfig.complete;e.instanceConfig.complete=function(t){m(s)&&s(t,e.file,e.inputElem),i()},S.parse(e.file,e.instanceConfig)}function n(e,r,n,i){m(t.error)&&t.error({name:e},r,n,i)}function i(){a.splice(0,1),r()}var s=t.config||{},a=[];return this.each(function(){var t="INPUT"==C(this).prop("tagName").toUpperCase()&&"file"==C(this).attr("type").toLowerCase()&&e.FileReader;if(!t||!this.files||0==this.files.length)return!0;for(var r=0;r<this.files.length;r++)a.push({file:this.files[r],inputElem:this,instanceConfig:C.extend({},s)})}),r(),this}}y?e.onmessage=p:S.WORKERS_SUPPORTED&&(v=h(),document.body?document.addEventListener("DOMContentLoaded",function(){b=!0},!0):b=!0),i.prototype=Object.create(n.prototype),i.prototype.constructor=i,s.prototype=Object.create(n.prototype),s.prototype.constructor=s,a.prototype=Object.create(a.prototype),a.prototype.constructor=a}("undefined"!=typeof window?window:this);